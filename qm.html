<!doctype html>
<html>
  <head>
    <title>Quiz Master Interface</title>
    <link rel="stylesheet" type="text/css" href="css">
  </head>
  <body>
    <h1>The Quiz Masters Page</h1>

    <table>
      <tr class='fullwidth'>
        <td class='fullwidth'>
          [NEW QUESTION] to get a question, [ASK] to send to Quizzers
        <td class='fullwidth'>
          <button class='brb' onClick="get_question()"> NEW QUESTION </button>
        </td>
      </tr>
    </table>


    <form id='quiz' action="">
      <input id="q" autocomplete="off" value="Get New Question" /><button id='ask'>ASK</button>
      <input id='ans' autocomplete="off" value="Press the New Question Button above"/>
    </form>
    <form id='chatter' action="">
      <input id="m" autocomplete="off" value="chat stuff"/><button>Send</button>
    </form>


    <h2>Who Answered</h2>
    <div id="quizzers"></div>

    <h2>Chat Messages</h2>
    <ul id="messages"></ul>

    <h2>Results</h2>
    <div id="results"></div>

    <script src="socket"></script>
    <script src="jquery"></script>
    <script>
      var socket = io();

      $(function () {

        $('#chatter').submit(function(){
          console.log("Chatter");
          socket.emit('chat message', $('#m').val());
          $('#m').val('');
          return false;
        });
        $('form').submit(function(evt){
          console.log(evt.currentTarget[0].id);
          if (evt.currentTarget[0].id == 'm') {
            return;
          }
          socket.emit('quiz message', evt.currentTarget[0].value);
          $('#quizzers').html('');
          $('#messages').html('');
          $('#ask').removeClass('ready');
          $('#ask').addClass('pressed');
          $('#ask').text('ASKED');
          return false;
        });
        socket.on('chat message', function(msg){
          $('#messages').append($('<li>').text(msg));
          window.scrollTo(0, document.body.scrollHeight);
        });
        socket.on('quiz message', function(msg){
          $('#messages').append($('<li>').text(msg));
          window.scrollTo(0, document.body.scrollHeight);
        });
        socket.on('answer message', function(msg){
          quiz_action = msg + ' <button onclick="reward(\'' + msg + '\')"> Reward </button> <button onclick="revoke(\'' + msg + '\')"> Revoke </button>' ;
          $('#quizzers').append($('<span class="quizzers">').html(quiz_action));
          window.scrollTo(0, document.body.scrollHeight);
        });
        socket.on('new question', function(msg){
          console.log("New Quesion: " + msg);
          parts = msg.split('?');
          $('#q').val(parts[0]+'?');
          $('#ans').val(parts[1]);          
          $('#ask').addClass('ready');
          $('#ask').text('READY');
          window.scrollTo(0, document.body.scrollHeight);
        });

        socket.on('results', function(msg){
          $('#results').html('');
          jQuery.each(msg, function(i, val) {
          $('#results').append($('<span class="result">').text(i +":" + val));
          });
        });

      });


      function reward(person){
        score = "{\"" + person + "\":1}";
        console.log("Reward for " + score);
        socket.emit('score message', JSON.parse(score));
      }
      function revoke(person){
        score = "{\"" + person + "\":-1}";
        console.log("Revoke for " + score);
        socket.emit('score message', JSON.parse(score));
      }

      function get_question(){
        socket.emit('generate','new') ;
        $('#ask').removeClass('pressed');
      }


    </script>

  </body>
</html>
